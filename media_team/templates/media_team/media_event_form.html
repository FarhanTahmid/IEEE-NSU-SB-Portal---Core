<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Events | IEEE NSU Student Branch</title>
    <link rel="icon" href="{% static 'logos/logo.gif' %}"/>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link rel="stylesheet" href="{% static 'newTable.css' %}" type="text/css" />

    {% block common_css %}
        {% include "common_css.html" %}
    {% endblock common_css %}
    <style>
        body, html {
        
        margin: 0;
        
        align-items: center;
        justify-content: center;
        }

        .row {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
        }
        /* Styles for the lightbox overlay */
        .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 999;
        }
        .row {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
          }
          .btn-container {
            text-align: center;
          }
          
          .btn {
            max-width: 100%;
            width: auto;
            display: inline-block;
            white-space: normal; /* Allow text to wrap within the button */
            word-wrap: break-word; /* Break long words if necessary */
            font-size: 16px; /* Adjust the font size as needed */
          }
          
          /* Media query for smaller screens (adjust the breakpoint as needed) */
          @media (max-width: 768px) {
            .btn {
              width: 100%; /* Make the button full width on smaller screens */
            }
          }

          @import url('https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i&subset=cyrillic,cyrillic-ext,greek,greek-ext,latin-ext,vietnamese');
          
          .upload__box {
            padding: 40px;
          }
          .upload__inputfile {
            width: 0.1px;
            height: 0.1px;
            opacity: 0;
            overflow: hidden;
            position: absolute;
            z-index: -1;
          }
          .upload__btn {
            display: inline-block;
            font-weight: 600;
            color: #fff;
            text-align: center;
            min-width: 116px;
            padding-top: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid;
            background-color: #00629B;
            border-color: #00629B;
            border-radius: 10px;
            line-height: 15px;
            font-size: 14px;
          }
          .upload__btn:hover {
            background-color: unset;
            color: #4045ba;
            transition: all 0.3s ease;
          }
          .upload__btn-box {
            margin-bottom: 10px;
          }
          .upload__img-wrap {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
          }
          .upload__img-box {
            width: 200px;
            padding: 0 10px;
            margin-bottom: 12px;
          }
          .upload__img-close {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.5);
            position: absolute;
            top: 10px;
            right: 10px;
            text-align: center;
            line-height: 24px;
            z-index: 1;
            cursor: pointer;
          }
          .upload__img-close:after {
            content: "âœ–";
            font-size: 14px;
            color: white;
          }
          
          .img-bg {
            background-repeat: no-repeat;
            background-position: center;
            background-size: cover;
            position: relative;
            padding-bottom: 100%;
          }
          #image-preview {
            width: 100%;
            cursor: pointer;
            transition: opacity 0.3s ease-in-out; /* Add a smooth transition effect */
        }

        #image-preview:hover {
            opacity: 0.7; /* Lower the opacity on hover */
        }

        #file-input {
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
          
          

        
    </style>
</head>
<body>
<!-- ############ LAYOUT START-->
<div class="app" id="app">

    <!-- aside -->
    <div id="aside" class="app-aside modal nav-dropdown">

          {% block sidebar %}
            {% include 'users/sidebar.html' %}
          {% endblock %}

    </div>
    <!-- aside end -->
    <!-- navbar content -->
    <div id="content" class="app-content box-shadow-z0" role="main">
        {% block navbar %}
            {% include 'media_navbar.html' %}
        {% endblock navbar %}

    </div>
    <!--navbar content-->
    <!-- ############ PAGE START-->
    <div ui-view class="app-body" style="justify-content:center; margin-left:15%; margin-right:15%;" id="view">


        <br>
        <h2 style="justify-content:center;text-align:center;margin-bottom:15px;">  <span><b>Events</b></span> organised by <span style="color:#00629B;">IEEE NSU Student Branch</b></span></h2>

        <!--Events Table-->
        <div style="text-align:center; margin-top=30px;">  
            <div class="container" style="justify-content:center;">
                <br><br>
                    <h3><b>{{event_name}}</b></h3>
                    <br>
                   
                        
                            
                                
                                   
                                        <div class="box-header">
                                            <h1 style="text-align:center;font-size:30px;">Add Details</h1>
                                        </div>
                                        
                                        <form method="POST" enctype="multipart/form-data">
                                            {% csrf_token %}
                                            <div class="box-body">
                                              
                                                    <div class="form-group row">
                                                        <label class="col-sm-2 form-control-label">Drive Link</label>
                                                        <div class="col-sm-10">
                                                            <input
                                                            placeholder="Provide Drive Link for The Event"
                                                            class="form-control"
                                                            type="url"
                                                            autocomplete="off"
                                                            required
                                                            id="#field1"
                                                            value="{{media_link}}"
                                                            name="drive_link_of_event"/>
                                
                                                        </div>
                                                    </div>
                                                    <div class="form-group row">
                                                        <label class="col-sm-2 form-control-label">Logo Link</label>
                                                        <div class="col-sm-10">
                                                            <input
                                                            placeholder="Provide Link for the Logo's"
                                                            class="form-control"
                                                            type="url"
                                                            autocomplete="off"
                                                            required
                                                            value="{{logo_link}}"
                                                            name="logo_link_of_event"/>
                                
                                                        </div>
                                                    </div>
                                                    {% if not exist %}
                                                    <div class="container" style="justify-content:center;">
                                                        <label class="form-group row"><b>Upload Maximum 6 images<b></label>
                                                            
                                                            
                                                          
                              
                                                          
                                                                       
                                                                        <div class="upload__box">
                                                                            <div class="upload__btn-box">
                                                                              <label class="upload__btn">
                                                                                <p>Upload Image</p>
                                                                                <input type="file" multiple="" name="images" data-max_length="20" class="upload__inputfile">
                                                                              </label>
                                                                            </div>
                                                                            <div class="upload__img-wrap"></div>
                                                                          </div>
                                                         
                                                    </div>
                                                    {% endif %}
                                          
                                                    <br>
                                                    <div class="footer" style="position:right;">
                                                      {% if exist %}
                                                         <button type="submit" name="add_event_pic_and_others" class="btn btn-success p-x-md" value="Update">Update</button> 
                                                      {% else %}
                                                         <button type="submit" name="add_event_pic_and_others" class="btn btn-success p-x-md" value="Add">Add</button>
                                                      {% endif %}              
                                                    </div>  
                                                </div>
                                                
                                                
                                            </div>
                                        </form>
                                    
                               
                            
                        
                    
                        
            </div>
          </div>

         
        
    
    
    
    
    
        </div>


        <div style="text-align:center; margin-top=30px;">
          <div class="container">
            <div class="box-body" style="justify-content:center;margin-right:100px;margin-left:300px;">
            {% if exist %}
                                                  
                                                    <div class="form-group row">
                                                        <label class="col form-control-label"><b>Previously Uploaded Pictures</b></label>
                                                        <div class="container" style="justify-content:center">
                                                        
                                                        {% for i in Img %}
                                                        <form method="POST" enctype="multipart/form-data">
                                                          {% csrf_token %}
                                                        <div class="container">
                                                            <img id="image-preview" src="{{media_url}}{{ i.selected_images}}" alt="Image {{ forloop.counter }}"  width=100% height=auto style="border: 2px solid black;on-hover: opacity;"  onclick="triggerFileInput(this)">
                                                            <input class="d-none" type="file"  id="file-input"   onchange="displayNewImage(this)" name="new_image">
                                                            <input type="hidden" value={{i.id}} name="ImageID">
                                                            
                                                        </div>
                                                        <br>
                                                        <input type="submit" class="btn btn-primary p-x-md" name="submitted_changed_picture" value="Change">
                                                        
                                                        
                                                        <br><br>
                                                      </form>  
                                                        {% endfor %}
                                                     
                                                    
                                                        </div>
                                
                                                        </div>
                                                    </div>
                                                    {% endif %}
                                                  </div>
          </div>
        </div>
     <!--Theme Switcher-->

     {% block theme_switcher %}
        {% include "theme_switcher.html" %}
    {% endblock theme_switcher %}
  </div>


<!-- app end-->
{% block common_js %}
        {% include "common_js.html" %}
    {% endblock common_js %}
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
   
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'table_search.js'%}"></script>
    <!--Script for image previewing on modal-->
    <script>
        jQuery(document).ready(function () {
            ImgUpload();
          });
          
          function ImgUpload() {
            var imgWrap = "";
            var imgArray = [];
          
            $('.upload__inputfile').each(function () {
              $(this).on('change', function (e) {
                imgWrap = $(this).closest('.upload__box').find('.upload__img-wrap');
                var maxLength = $(this).attr('data-max_length');
          
                var files = e.target.files;
                var filesArr = Array.prototype.slice.call(files);
                var iterator = 0;
                filesArr.forEach(function (f, index) {
          
                  if (!f.type.match('image.*')) {
                    return;
                  }
          
                  if (imgArray.length > maxLength) {
                    return false
                  } else {
                    var len = 0;
                    for (var i = 0; i < imgArray.length; i++) {
                      if (imgArray[i] !== undefined) {
                        len++;
                      }
                    }
                    if (len > maxLength) {
                      return false;
                    } else {
                      imgArray.push(f);
          
                      var reader = new FileReader();
                      reader.onload = function (e) {
                        var html = "<div class='upload__img-box'><div style='background-image: url(" + e.target.result + ")' data-number='" + $(".upload__img-close").length + "' data-file='" + f.name + "' class='img-bg'><div class='upload__img-close'></div></div></div>";
                        imgWrap.append(html);
                        iterator++;
                      }
                      reader.readAsDataURL(f);
                    }
                  }
                });
              });
            });
          
            $('body').on('click', ".upload__img-close", function (e) {
              var file = $(this).parent().data("file");
              for (var i = 0; i < imgArray.length; i++) {
                if (imgArray[i].name === file) {
                  imgArray.splice(i, 1);
                  break;
                }
              }
              $(this).parent().parent().remove();
            });
          }
          function triggerFileInput(element) {
            element.nextElementSibling.click();
        }
    
        function displayNewImage(input) {
            var preview = input.previousElementSibling;
            var file = input.files[0];
    
            if (file) {
                var reader = new FileReader();
    
                reader.onload = function (e) {
                    preview.src = e.target.result;
                };
    
                reader.readAsDataURL(file);
            }
        }
        
         
    </script>
    
</body>
</html>