{% load static %}

<!--YOU MUST IMPORT THE event.css IN THE HTML FILE YOU ARE USING THIS BLOCK. JS IS INTEGRATED IN THIS BLOCK -->

{% block event_container %}

<style>
    .load-more-button {
      background-color: #002855;
      border: none;
      color: white;
      padding: 15px 32px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      margin: 4px 2px;
      cursor: pointer;
      border-radius:7px;
      transition: .3s ease-in-out;
      font-weight:bold; 
    }

    .load-more-button:hover{
        background-color: #FFC72C;
    }

    .article-image {
        width: 100%; /* Make the image fill the container */
        height: 250px; /* Fix the image height to 250px */
        object-fit: cover; /* Maintain aspect ratio and cover the container */
      }
</style>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

<!-- Search Section -->
<h3 style="text-align: center; margin: 40px 0px; font-weight: bold;"><span style="border-bottom: 4px solid #fecd13;">OUR E</span>VENTS</h3>
<div class="search_event">
    
    <input
    type="text"
    id="eventFilter"
    onkeyup="eventFilterFunction()"
    placeholder="Search by event name.."
    title="Type in a name"
    />
</div>

<!--EVENT CARD CONTAINER-->

<section class="event">
    <div class="event-container container" style="padding:0px; "> 
        <!-- hello  -->
        <!-- <div class="event_search">
            <label>Search: </label>
            <input type="text" onkeyup="searchfunction()" id="search" placeholder="Search with event title">
        </div> -->
        <div class="row m-0 box-container" style="transition: .3s ease-in-out; ">
            {% for key, value in all_events.items %}
            <div style="border-radius: 7px;" class="col-lg-4 col-md-6 col-sm-12 mt-4 mx-0 gdlr-item gdlr-blog-grid gdlr-skin-box event_box">
                <article id="post-2255"
                    class="post-2255 post type-post status-publish format-standard has-post-thumbnail hentry category-post-slider tag-blog tag-life-style" style="border: 1px solid black;">
                    <div class="gdlr-standard-style">
                        <div class="gdlr-blog-thumbnail">
                            <a href="{% url 'main_website:event_details' key.id %}"> <img
                                    class="article-image"
                                    src="{{media_url}}{{value}}"
                                    alt="" width="100%" /></a>
                        </div>

                        <div class="gdlr-blog-grid-content">
                            <header class="post-header">
                                <div class="gdlr-blog-info">
                                    <div
                                        class="blog-info blog-date gdlr-skin-info">
                                        <span class="gdlr-sep">/</span><a
                                            href="{% url 'main_website:event_details' key.id %}">{{key.event_date}}</a></div>
                                    <div
                                        class="blog-info blog-author gdlr-skin-info">
                                        <span class="gdlr-sep">/</span>By <a
                                            href="{% url 'main_website:event_details' key.id %}" title="{{key.event_organiser.group_name}}"
                                            rel="author">{{key.event_organiser.short_form}}</a></div>
                                    <div class="clear"></div>
                                </div>

                                <h3 class="gdlr-blog-title event_name"><a href="{% url 'main_website:event_details' key.id %}">{{key.event_name}}</a></h3>
                                <div class="clear"></div>
                            </header>
                            <!-- entry-header -->

                            <div class="description-container" style="display: -webkit-box;
                            overflow: hidden;
                            -webkit-box-orient: vertical;
                            text-overflow: ellipsis;
                            -webkit-line-clamp: 5;">
                                <p class="card-text">{{key.event_description | safe }}</p>
                            </div>
                            <a href="{% url 'main_website:event_details' key.id %}" class="excerpt-read-more">Read More</a>
                        </div>
                    </div>
                </article>
            </div>
            {% endfor %}
        </div>
    <div class="text-center mt-4 mb-5">
          <button class="load-more-button load-more">LOAD MORE</button>
    </div>
        
    </div>
</section>


<!-- event load more button -->
<script>
    const loadMore = document.querySelector('.load-more');
    let currentItem = 3;

    loadMore.addEventListener('click', (e) => {
        const elementList = [...document.querySelectorAll('.event-container .box-container .gdlr-item.gdlr-blog-grid.gdlr-skin-box')];
        for (let i = currentItem; i < currentItem + 3; i++) {
            if (elementList[i]) {
                elementList[i].style.display = 'flex';
            }
        }
        currentItem += 3;

        //hide load more button after fully loaded
        if (currentItem >= elementList.length) {
            loadMore.style.display = 'none';
        }
    })

    //EVENT SEARCH FUNCTION WITH NAME ONLY
    function searchfunction() {
        let input, filter, table, tr, td, j;
        input = document.getElementById("search");
        filter = input.value.toUpperCase();
        table = document.querySelector(".box-container");
        tr = table.querySelector(".box");

        for (j = 0; j < tr.length; j++) {
            td = tr[j].getElementsByTagName("div");
            message = document.getElementById("no_data");

            if (td.length > 0) {
                if (td[2].innerHTML.toUpperCase().indexOf(filter) > -1) {
                    tr[j].style.display = "";
                    message.innerHTML = "";
                }
                else {
                    tr[j].style.display = "none";
                }

            }
            if (td.length == 0) {
                message.innerHTML = "Event not found!";
            }
        }
    }
</script>
{% endblock event_container %}
